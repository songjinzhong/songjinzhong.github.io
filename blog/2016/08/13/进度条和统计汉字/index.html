<!doctype html><html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="author" content="song"><meta name="description" content="建站 进度条 统计 汉字"><title>我的建站路5：增加进度条和统计汉字个数 | 渔人</title><link rel="alternate" href="/blog/rss.xml" title="渔人"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/all.min.css"></head><body><div class="post"><h1 class="overview"><a href="/blog/rss.xml" class="web-feed" title="RSS订阅" target="_blank"></a> <i class="search-icon"></i> <a href="/">渔人</a> <font>» </font><a href="/blog">博客</a> <font>» </font><a href="/blog/archives">归档</a><div class="big-search"><i class="close-icon"></i><div class="search-container"><form class="search-form"><input class="search-input js-search-input" type="text" placeholder="请输入关键字"></form><div class="js-search-results"></div></div></div></h1><div class="post-info"><h1>我的建站路5：增加进度条和统计汉字个数</h1><div class="author-info"><p class="author">作者:<a href="/">宋进忠</a></p><p class="date">时间: <span>2016/08/13</span></p><p class="cat-arc"><span>分类: <a href="/blog/categories/建站/">建站</a> </span><span>标签: <a href="/blog/tags/建站/">建站</a> / <a href="/blog/tags/JavaScript/">JavaScript</a></span></p></div></div><div class="post-markdown"><p><img class="img-mid" src="http://ww2.sinaimg.cn/mw690/e3dde130gw1f8hoy2i9wcj20zk0qotj8.jpg" alt="图片来源网上" title="图片来源于网络"></p><p>先看一下效果吧，这是我博客中的例子：</p><p><strong>图1</strong></p><p><img src="/content/images/2016/08/jindutiao1.png" alt=""></p><p><strong>图2</strong></p><p><img src="/content/images/2016/08/jindutiao2.png" alt=""></p><p>先是统计本文的字数，估计一个大致阅读时间（阅读时间做法比较粗糙），随着屏幕向下划，阅读进度不断更新，同时进度条也向右滚动。</p><p>这个其实是抄袭来的，感觉很炫酷，就拿过来用了。那个博客是个外国人的，我通过网页，把代码一点一点的搬过来，然后稍微修改，加入对中文的支持（也费了很大功夫才完成）。</p><h3 id="在博客中添加"><a href="#在博客中添加" class="headerlink" title="在博客中添加"></a>在博客中添加</h3><p>能用到进度条的也就是在 post.hbs 页面中，即博客的内容页面，理所应当，进度条应该放到这里。它们显示的位置已经被规定死了，在顶端部分。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><code class="html"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"reading-time-indicator js-post-sticky-header"</span>&gt;</span>
	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post-reading-time js-post-reading-time"</span>&gt;</span>
		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"percent js-percent-count"</span>&gt;</span>0%<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
		<span class="tag">&lt;<span class="name">progress</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">class</span>=<span class="string">"read-progress-indicator single"</span> <span class="attr">max</span>=<span class="string">"12982"</span>&gt;</span>
			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"progress-container"</span>&gt;</span>
				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"progress-bar"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span>
			<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">progress</span>&gt;</span>
		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"read-estimation"</span>&gt;</span>
			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"reading-time-blog-logo"</span>&gt;</span>
				<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"blog-logo"</span> <span class="attr">href</span>=<span class="string">"javascript:history.go(-1)"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa fa-chevron-left"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>
			<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"read-estimation-content"</span>&gt;</span>
				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"estimated-time"</span>&gt;</span>
					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"js-word-count"</span>&gt;</span>3245<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 字 --- 耗时<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"eta"</span>&gt;</span>5 分钟<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.
				<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
			<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
		<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
	<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span></code></pre></td></tr></table></figure><p>进度条有两个功能，先来介绍一下进度条吧。</p><h3 id="进度条"><a href="#进度条" class="headerlink" title="进度条"></a>进度条</h3><p>通过 html 标签可以看到，进度条用的是一个叫做 <strong>progess</strong> 的 HTML 5标签，这个标签支持 max 和 value 属性，分别定义完成时的值和当前已经完成的值（其实我觉得还不如用百分百来的直接）。<a href="http://www.w3school.com.cn/html5/html5_progress.asp">W3School对 Progess 的介绍</a></p><p><strong>既然是一个百分百，这个百分百从何而来？</strong></p><p>max 的内容好办，肯定是文章的长度。文章内容最外层是包裹在 html 的 article 标签里，真正的内容是在 <code>class=post-content</code>里，令 <code>max=$(&#39;.post-content&#39;).height()</code>。</p><p>value 是根据当前 window 的滑动条的长度决定的，<code>value=$(window).scrollTop()</code><strong>有一个问题</strong>，当前的滑动条包括 header 部分，长度大概有 400px ，但是不固定，带来的结果导致我们浏览的进度条总是比实际值要快，这部分需要剪掉，<code>value=$(window).scrollTop()-$(&#39;header&#39;).height()-240</code>。表达式最后减的 240 是<code>padding-bottom</code> 和 <code>padding-top</code> 的长度。</p><p>函数如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><code class="javascript"><span class="keyword">var</span> getHeader = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;
	<span class="keyword">return</span> $(<span class="string">'header'</span>).height()+<span class="number">240</span>
&#125;
<span class="keyword">var</span> getMax = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;
	<span class="keyword">return</span> $(<span class="string">'.post-content'</span>).height();
&#125;;
<span class="keyword">var</span> getValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;
	<span class="keyword">return</span> $(<span class="built_in">window</span>).scrollTop()-getHeader();
&#125;;</code></pre></td></tr></table></figure><p>当滑动条处于 top 位置或者读完整个文章后，要把进度条隐藏，当进度条刷新时，不断改变当前 value 的值。</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><code class="mel">$(document).on(<span class="string">'scroll'</span>, function()&#123;
	<span class="comment">// On scroll only Value attr needs to be calculated</span>
	<span class="keyword">progressBar</span>.attr(&#123; value: getValue() &#125;);
	<span class="keyword">percent</span> = Math.<span class="keyword">floor</span>((getValue() / getMax()) * <span class="number">100</span>) ;
	<span class="keyword">if</span> (<span class="keyword">percent</span> &lt; <span class="number">0</span>) &#123;
		<span class="keyword">percent</span> = <span class="number">0</span>;
		$(<span class="string">'.js-post-sticky-header'</span>).removeClass(<span class="string">'visible'</span>);
	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">percent</span> &gt; <span class="number">100</span>) &#123;
		<span class="keyword">percent</span> = <span class="number">100</span>;
		$(<span class="string">'.js-post-sticky-header'</span>).removeClass(<span class="string">'visible'</span>);
	&#125; <span class="keyword">else</span> &#123;
		$(<span class="string">'.js-post-sticky-header'</span>).addClass(<span class="string">'visible'</span>);
	&#125;
	$(<span class="string">'.js-percent-count'</span>).<span class="keyword">text</span>(<span class="keyword">percent</span> + <span class="string">'%'</span>);
&#125;);
$(<span class="keyword">window</span>).resize(function()&#123;
	<span class="comment">// On resize, both Max/Value attr needs to be calculated</span>
	<span class="keyword">progressBar</span>.attr(&#123; <span class="keyword">max</span>: getMax(), value: getValue() &#125;);
&#125;);</code></pre></td></tr></table></figure><h3 id="设置阅读时间"><a href="#设置阅读时间" class="headerlink" title="设置阅读时间"></a>设置阅读时间</h3><p>先要统计文本的数量，由于原 api 只能支持英文，我加入了中文和数字的统计，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><code class="javascript"><span class="comment">//通过正则表达式来获得文档的单词，汉字和数字个数</span>
<span class="comment">//text = $('.Post-Content').text();</span>
<span class="keyword">var</span> totalWords=<span class="number">0</span>;
<span class="keyword">var</span> pattern_char = <span class="regexp">/[a-zA-Z]+/g</span>;
<span class="keyword">var</span> pattern_cn = <span class="regexp">/[\u4e00-\u9fa5]/g</span>;
<span class="keyword">var</span> pattern_num = <span class="regexp">/[0-9]+/g</span>
<span class="keyword">var</span> count_char = text.match(pattern_char)?text.match(pattern_char).length:<span class="number">0</span>;
<span class="keyword">var</span> count_cn = text.match(pattern_cn)?text.match(pattern_cn).length:<span class="number">0</span>;
<span class="keyword">var</span> count_num=text.match(pattern_num)?text.match(pattern_num).length:<span class="number">0</span>;
totalWords=count_char+count_cn+count_num;</code></pre></td></tr></table></figure><p>其中，pattern_char 用来匹配英文单词数量，pattern_cn用来统计汉字数量，pattern_num用来统计纯数字的数量，然后把他们相加就是 totalWords 的数量。</p><p>其他的就没什么了，想法都很简单，具体可以参考 <a href="https://github.com/songjinzhong/GhostTheme_sjz">Github源码</a>，本文介绍的源码在 assets/js/main.js 和 assets/js/vendor/reading-time.js 两个文件中。</p></div><div class="pre-next clear"><div class="pre-page"><i class="pre-icon"></i> <a href="/blog/2016/08/14/每天一道前端面试题（定期更新）/">每天一道前端面试题（定期更新）</a></div><div class="next-page"><a href="/blog/2016/08/12/lunrjs的中文支持/">我的建站路4：解决 lunr.js 的中文支持问题</a> <i class="next-icon"></i></div></div><div class="post-footer"><a href="/blog/rss.xml" class="post-feed" target="_black">Feed <i class="feed-icon"></i></a><h3>文档信息</h3><ul><li><span>版权声明：</span><span>自由转载-非商用-保持署名</span><a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">(创意共享3.0许可证)</a></li><li><span>发表日期：</span><span>2016-08-13 16:50:10</span></li><li><span>本文分类：</span><span> <a href="/blog/categories/建站/">建站</a></span></li><li><span>本文标签：</span><span> <a href="/blog/tags/建站/">建站</a> / <a href="/blog/tags/JavaScript/">JavaScript</a></span></li><li><span>最后编辑：</span><span>2016-10-05 21:05:09</span></li><li><span>社交媒体：</span><span><a href="https://github.com/songjinzhong">GitHub<i class="github"></i></a><a href="http://weibo.com/3822969136">微博<i class="weibo"></i></a></span></li><li><span>分享文章：</span> <span><div class="ds-share" data-thread-key="blog/2016/08/13/进度条和统计汉字/" data-title="我的建站路5：增加进度条和统计汉字个数" data-images="" data-content="先看一下效果吧，这是我博客中的例子：图1图2先是统计本文的字数，估计一个大致阅读时间（阅读时间做法比较粗糙），随着屏幕向下划，阅读进度不断更新，同时进度条也向右滚动。这个其实是抄袭来的，感觉很炫酷，就拿过来用了。那个博客是个外国人的，..." data-url="http://yuren.space/blog/2016/08/13/进度条和统计汉字/"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li><li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li><li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div></span></li></ul></div><div class="page-related"><h2>相关文章</h2><ul><li><span>2016.09.28</span><a href="/blog/2016/09/28/原型链/">JS 进阶之路 : 原型链</a><p>刚学习 JavsScript 的时候，感觉它有点混乱，以前接触 C++或 ...</p></li><li><span>2016.09.24</span><a href="/blog/2016/09/24/闭包/">JS 进阶之路 : 闭包</a><p>函数在 JavaScript 中是第一型对象，而闭包的使用使其变得非常灵活...</p></li><li><span>2016.09.11</span><a href="/blog/2016/09/11/深入理解函数的概念/">JS 进阶之路 : 深入理解函数的概念</a><p>之前一直觉得自己对 JavaScript 这门语言掌握的还可以，记得当初学...</p></li><li><span>2016.09.07</span><a href="/blog/2016/09/07/腾讯404公益页面/">腾讯404公益页面，你中招了吗</a><p>之前在别人的博客里看到了腾讯的 404 公益页面，感觉很不错，算是腾讯的良...</p></li></ul></div><div class="duoshuo-part" id="comments"><div class="ds-thread" data-thread-key="blog/2016/08/13/进度条和统计汉字/" data-title="我的建站路5：增加进度条和统计汉字个数" data-url="http://yuren.space/blog/2016/08/13/进度条和统计汉字/"></div><style type="text/css">.ds-sync{white-space:normal}.ds-post{transition:all .3s!important}.ds-post:hover{transition:all .3s!important;border-radius:5px!important;background:#F3F3F3!important}#ds-thread #ds-reset .ds-comments{border-bottom:none;padding:15px 0}#ds-thread #ds-reset .ds-powered-by{display:none}.ds-thread .ds-loading{padding:20px 0;text-align:center;color:#AFAFAF;background-color:#EFEFEF;border-radius:5px;line-height:30px;font-style:15px}#ds-thread .ds-loading{display:none;height:0;visibility:hidden}#ds-thread #ds-reset .ds-comments{border-bottom:none}#ds-thread #ds-reset a:hover,.ds-like-panel{color:#999}#ds-reset .ds-avatar,#ds-reset .ds-avatar img{border-radius:100%}#ds-thread #ds-reset li.ds-post{border-top:none}div#ds-thread #ds-reset .ds-comment-body p{color:#000}#ds-thread #ds-reset .ds-comment-body a{color:#777!important}#ds-thread #ds-reset li.ds-tab a{text-shadow:none}#ds-thread #ds-reset .ds-sort a.ds-current,#ds-thread #ds-reset .ds-sort a:active{color:#e58c7c}#ds-thread #ds-reset .ds-post-self{border-top:none}.ds-thread-like-text{display:block}.ds-thread-cancel-like{display:none}.ds-thread-liked .ds-thread-like-text{display:none}.ds-thread-liked .ds-thread-cancel-like{display:block}#ds-thread #ds-reset img{transition:all .3s}#ds-thread #ds-reset img:hover{transform:rotate(180deg);transition:all .3s}div#ds-thread #ds-reset .ds-comment-body{color:#555}#ds-thread #ds-reset .ds-comment-body a[data-user-id='6314610027441160961']::after{content:"博主";border:1px solid #e58c7c;border-radius:2px;margin-left:4px;color:#e58c7c;padding:0 2px;font-size:12px;line-height:14px;display:inline-block}.ds-post-reply,.ds-post-repost{display:none}.ds-post-self:hover .ds-post-reply,.ds-post-self:hover .ds-post-repost{display:inline}.ds-user-name{font-size:14px!important;line-height:42px!important}.ds-children .ds-user-name{line-height:26px!important}div#ds-thread #ds-reset .ds-comment-body p{font-size:16px!important}div#ds-thread #ds-reset .ds-comment-header .ds-user-name{font-size:18px!important;font-family:consolas!important;line-height:30px!important}div#ds-thread #ds-reset .ds-textarea-wrapper textarea{height:120px!important;font-size:16px!important;font-family:Consolas,Georgia,serif}@media (max-width:800px){div#ds-thread #ds-reset .ds-textarea-wrapper textarea{height:70px!important}}div#ds-thread #ds-reset .ds-post-options{overflow:hidden}div#ds-thread #ds-reset .ds-post-toolbar{box-shadow:none}div#ds-thread #ds-reset .ds-post-button{position:relative;margin-top:20px;font-size:16px}div#ds-thread #ds-reset .ds-post-options{margin-right:0!important;border-right:1px solid #CCC}@media screen and (max-width:641px){div#ds-thread #ds-reset .ds-replybox{padding:0!important}div#ds-thread #ds-reset .ds-replybox .ds-avatar{display:none!important}.ds-post-self:hover .ds-post-reply,.ds-post-self:hover .ds-post-report,.ds-post-self:hover .ds-post-repost{display:none!important}}div#ds-thread #ds-reset .ds-comment-body p{white-space:pre-wrap;font-family:consolas!important}#ds-thread #ds-reset .ds-paginator a{font-size:20px!important}#ds-thread #ds-reset .ds-login-buttons p{color:#999}#ds-thread #ds-reset .ds-comment-body{background:#fbfbfb;padding:15px 15px 12px 32px;border-radius:5px;box-shadow:0 1px 2px rgba(0,0,0,.15),0 1px 0 rgba(255,255,255,.75) inset}</style><script type="text/javascript">var duoshuoQuery={short_name:"songjz"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></div><div class="web-info">Copyright © 2016-2017,本站由 <a href="/blog/web-info">本人</a> 手工打造,历时2周, <a href="/blog/web-info/#link">联系方式</a> <span>网站参考 <a href="http://www.barretlee.com/">小胡子哥</a>/ <a href="http://www.ruanyifeng.com/home.html">阮一峰老师</a></span></div></div><div class="tools"><i class="back-to-top" style="display:none"></i> <i class="goto-comments"></i></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/all.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?513bc3e28555252418b03cc8e660bc31";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85346637-1","auto"),ga("send","pageview")</script></body></html>