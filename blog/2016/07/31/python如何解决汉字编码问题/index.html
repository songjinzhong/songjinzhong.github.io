<!doctype html><html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="author" content="song"><meta name="description" content="Python Unicode Decode Error 解决 汉字 编码 问题"><title>Unicode Decode Error: python 如何解决汉字编码问题 | 渔人</title><link rel="alternate" href="/blog/rss.xml" title="渔人"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/all.min.css"></head><body><div class="post"><h1 class="overview"><a href="/blog/rss.xml" class="web-feed" title="RSS订阅" target="_blank"></a> <i class="search-icon"></i> <a href="/">渔人</a> <font>» </font><a href="/blog">博客</a> <font>» </font><a href="/blog/archives">归档</a><div class="big-search"><i class="close-icon"></i><div class="search-container"><form class="search-form"><input class="search-input js-search-input" type="text" placeholder="请输入关键字"></form><div class="js-search-results"></div></div></div></h1><div class="post-info"><h1>Unicode Decode Error: python 如何解决汉字编码问题</h1><div class="author-info"><p class="author">作者:<a href="/">宋进忠</a></p><p class="date">时间: <span>2016/07/31</span></p><p class="cat-arc"><span>分类: <a href="/blog/categories/Python/">Python</a> </span><span>标签: <a href="/blog/tags/Python/">Python</a> / <a href="/blog/tags/编码/">编码</a></span></p></div></div><div class="post-markdown"><p>由于项目需要，需要读取一个含有中文的txt文档，完了还要保存文件。文档之前是由base64编码，导致所有汉字读取显示乱码。项目组把base64废弃之后，先后出现两个错误：</p><ul><li><strong>ascii codec can’t encode characters in position ordinal not in range 128</strong></li><li><strong>UnicodeDecodeError: ‘utf8’ codec can’t decode byte 0x</strong>。</li></ul><p><img class="img-mid" src="http://ww2.sinaimg.cn/mw690/e3dde130gw1f8hiwd04w4j20zk0jz0z5.jpg" alt="图片来源网上" title="图片来源于网络"></p><p>如果对于ascii、unicode和utf-8还不了解的小伙伴，可以看之前的这篇博客<a href="http://blog.songjz.cn/guan-yu-zi-fu-chuan-he-bian-ma/">关于字符串和编码</a></p><p>那么必须对下面这三个概念有所了解：</p><ul><li>ascii只能表示数字、英文字母和一些特殊符号，不能表示汉字</li><li>unicode和utf-8都可以表示汉字，unicode是固定长度，utf-8是可变长度</li><li>内存中存储方式一般为unicode，而磁盘文件存储方式一般为utf-8，因为utf-8可以节约存储空间</li></ul><p>那么python的默认编码是什么？</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><code class="ruby"><span class="meta">&gt;&gt;</span>&gt; import sys
<span class="meta">&gt;&gt;</span>&gt; sys.getdefaultencoding()
<span class="string">'ascii'</span>
<span class="meta">&gt;&gt;</span>&gt; reload(sys)
&lt;<span class="class"><span class="keyword">module</span> '<span class="title">sys</span>' (<span class="title">built</span>-<span class="title">in</span>)&gt;</span>
<span class="meta">&gt;&gt;</span>&gt; sys.setdefaultencoding(<span class="string">'utf-8'</span>)
<span class="meta">&gt;&gt;</span>&gt; sys.getdefaultencoding()
<span class="string">'utf-8'</span></code></pre></td></tr></table></figure><p>python的默认编码是<code>ascii</code>，可以通过<code>sys.setdefaultencoding(&#39;utf-8&#39;)</code>函数设置python的默认编码。</p><p>python中可以通过<code>encode</code>和<code>decode</code>的方式改变数据的编码，比如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><code class="python"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'汉字'</span>
<span class="string">u'\u6c49\u5b57'</span>
<span class="meta">&gt;&gt;&gt; </span><span class="string">u'汉字'</span>.encode(<span class="string">'utf-8'</span>)
<span class="string">'\xe6\xb1\x89\xe5\xad\x97'</span>
<span class="meta">&gt;&gt;&gt; </span><span class="string">u'汉字'</span>.encode(<span class="string">'utf-8'</span>).decode(<span class="string">'utf-8'</span>)
<span class="string">u'\u6c49\u5b57'</span></code></pre></td></tr></table></figure><p>我们可以通过这两个函数设置编码。</p><p>那么，python中的str是什么类型？</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><code class="ruby"><span class="meta">&gt;&gt;</span>&gt; import binascii
<span class="meta">&gt;&gt;</span>&gt; <span class="string">'汉字'</span>
<span class="string">'\xba\xba\xd7\xd6'</span>
<span class="meta">&gt;&gt;</span>&gt; type(<span class="string">'汉字'</span>)
&lt;type <span class="string">'str'</span>&gt;
<span class="meta">&gt;&gt;</span>&gt; print binascii.b2a_hex(<span class="string">'汉字'</span>)
babad7d6
<span class="meta">&gt;&gt;</span>&gt; print binascii.b2a_hex(u<span class="string">'汉字'</span>)
Traceback (most recent call last):
  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;<span class="class"><span class="keyword">module</span>&gt;</span>
<span class="symbol">UnicodeEncodeError:</span> <span class="string">'ascii'</span> codec can<span class="string">'t encode characters in
position 0-1: ordinal not in range(128)
&gt;&gt;&gt; print binascii.b2a_hex(u'</span>汉字<span class="string">'.encode('</span>utf-<span class="number">8</span><span class="string">'))
e6b189e5ad97
&gt;&gt;&gt; print binascii.b2a_hex(u'</span>汉字<span class="string">'.encode('</span>gbk<span class="string">'))
babad7d6</span></code></pre></td></tr></table></figure><p><code>binascii</code>是将数据的二进制转换成ascii，上面的解释是：‘汉字’的类型是<code>str</code>，二进制是<code>babad7d6</code>，u‘汉字’是无法转换成ascii，这样就报出了开头的第一个错误。解决办法就是把它.encode(‘utf-8’)成<code>str</code>类型。因为我命令行是windows默认的GBK编码，所有u’汉字’.encode(‘gbk’)的时候，输出结果和‘汉字’结果一样。</p><p>总结一下，python的<code>str</code>实际上是unicode的一种，python的默认编码是ascii，对于非ascii转成ascii的时候都会报错，牢记下面的规则：</p><ul><li><strong>unicode =&gt; encode(‘合适的编码’) =&gt; str</strong></li><li><strong>str =&gt; decode(‘合适的编码’) =&gt; unicode</strong></li></ul><p>还有一种简单的方式，就是在文件头设置编码，可以省去很多麻烦：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><code class="stylus">import sys
<span class="function"><span class="title">reloads</span><span class="params">(sys)</span></span>
sys.setdefaultencoding(<span class="string">'utf-8'</span>)</code></pre></td></tr></table></figure><p>对于第二个问题，是在文件读取的时候出的错。utf-8的文件有bom和无bom两种方式，两者的差别好像在bom文件比无bom文件多了一个头，导致以utf-8方式读文件时报错，我先前曾尝试读文件的时候先对有无bom进行判断，跳过bom文件的头，后来失败了⊙﹏⊙真尴尬～～。</p><p>还得上google求助大神，<a href="http://stackoverflow.com/questions/12468179/unicodedecodeerror-utf8-codec-cant-decode-byte-0x9c">原帖在这</a>，具体的操作方法就是使用<code>codecs</code>库来读文件（我猜这个库就是对文件的头进行检测）。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><code class="arduino"><span class="keyword">import</span> codecs
codecs.<span class="built_in">open</span>(file_name, <span class="string">"r"</span>,encoding=<span class="string">'utf-8'</span>, errors=<span class="string">'ignore'</span>)</code></pre></td></tr></table></figure><p>对于编码问题，一定要懂得<code>ascii</code>、<code>unicode</code>和<code>utf-8</code>工作原理。</p><p>今天就写到这吧。</p></div><div class="pre-next clear"><div class="pre-page"><i class="pre-icon"></i> <a href="/blog/2016/08/01/chunked数据错位问题/">处理 Http 协议中的 chunked 数据错位问题</a></div><div class="next-page"><a href="/blog/2016/07/30/关于字符串和编码/">关于字符串和编码</a> <i class="next-icon"></i></div></div><div class="post-footer"><a href="/blog/rss.xml" class="post-feed" target="_black">Feed <i class="feed-icon"></i></a><h3>文档信息</h3><ul><li><span>版权声明：</span><span>自由转载-非商用-保持署名</span><a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">(创意共享3.0许可证)</a></li><li><span>发表日期：</span><span>2016-07-31 22:42:21</span></li><li><span>本文分类：</span><span> <a href="/blog/categories/Python/">Python</a></span></li><li><span>本文标签：</span><span> <a href="/blog/tags/Python/">Python</a> / <a href="/blog/tags/编码/">编码</a></span></li><li><span>最后编辑：</span><span>2016-10-05 17:42:36</span></li><li><span>社交媒体：</span><span><a href="https://github.com/songjinzhong">GitHub<i class="github"></i></a><a href="http://weibo.com/3822969136">微博<i class="weibo"></i></a></span></li><li><span>分享文章：</span> <span><div class="ds-share" data-thread-key="blog/2016/07/31/python如何解决汉字编码问题/" data-title="Unicode Decode Error: python 如何解决汉字编码问题" data-images="" data-content="由于项目需要，需要读取一个含有中文的txt文档，完了还要保存文件。文档之前是由base64编码，导致所有汉字读取显示乱码。项目组把base64废弃之后，先后出现两个错误：ascii codec can’t encode charact..." data-url="http://yuren.space/blog/2016/07/31/python如何解决汉字编码问题/"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li><li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li><li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div></span></li></ul></div><div class="page-related"><h2>相关文章</h2><ul><li><span>2016.08.27</span><a href="/blog/2016/08/27/PythonImageMagick批量处理图片/">Windows下用 Python + ImageMagick 批量处理图片</a><p>这周研究漏洞时，看了一下关于 ImageMagick 的漏洞，它是远程代码...</p></li><li><span>2016.07.30</span><a href="/blog/2016/07/30/关于字符串和编码/">关于字符串和编码</a><p>字符编码上周用Python写代码的时候，再次遇到头疼的编码问题，读写文件的...</p></li></ul></div><div class="duoshuo-part" id="comments"><div class="ds-thread" data-thread-key="blog/2016/07/31/python如何解决汉字编码问题/" data-title="Unicode Decode Error: python 如何解决汉字编码问题" data-url="http://yuren.space/blog/2016/07/31/python如何解决汉字编码问题/"></div><style type="text/css">.ds-sync{white-space:normal}.ds-post{transition:all .3s!important}.ds-post:hover{transition:all .3s!important;border-radius:5px!important;background:#F3F3F3!important}#ds-thread #ds-reset .ds-comments{border-bottom:none;padding:15px 0}#ds-thread #ds-reset .ds-powered-by{display:none}.ds-thread .ds-loading{padding:20px 0;text-align:center;color:#AFAFAF;background-color:#EFEFEF;border-radius:5px;line-height:30px;font-style:15px}#ds-thread .ds-loading{display:none;height:0;visibility:hidden}#ds-thread #ds-reset .ds-comments{border-bottom:none}#ds-thread #ds-reset a:hover,.ds-like-panel{color:#999}#ds-reset .ds-avatar,#ds-reset .ds-avatar img{border-radius:100%}#ds-thread #ds-reset li.ds-post{border-top:none}div#ds-thread #ds-reset .ds-comment-body p{color:#000}#ds-thread #ds-reset .ds-comment-body a{color:#777!important}#ds-thread #ds-reset li.ds-tab a{text-shadow:none}#ds-thread #ds-reset .ds-sort a.ds-current,#ds-thread #ds-reset .ds-sort a:active{color:#e58c7c}#ds-thread #ds-reset .ds-post-self{border-top:none}.ds-thread-like-text{display:block}.ds-thread-cancel-like{display:none}.ds-thread-liked .ds-thread-like-text{display:none}.ds-thread-liked .ds-thread-cancel-like{display:block}#ds-thread #ds-reset img{transition:all .3s}#ds-thread #ds-reset img:hover{transform:rotate(180deg);transition:all .3s}div#ds-thread #ds-reset .ds-comment-body{color:#555}#ds-thread #ds-reset .ds-comment-body a[data-user-id='6314610027441160961']::after{content:"博主";border:1px solid #e58c7c;border-radius:2px;margin-left:4px;color:#e58c7c;padding:0 2px;font-size:12px;line-height:14px;display:inline-block}.ds-post-reply,.ds-post-repost{display:none}.ds-post-self:hover .ds-post-reply,.ds-post-self:hover .ds-post-repost{display:inline}.ds-user-name{font-size:14px!important;line-height:42px!important}.ds-children .ds-user-name{line-height:26px!important}div#ds-thread #ds-reset .ds-comment-body p{font-size:16px!important}div#ds-thread #ds-reset .ds-comment-header .ds-user-name{font-size:18px!important;font-family:consolas!important;line-height:30px!important}div#ds-thread #ds-reset .ds-textarea-wrapper textarea{height:120px!important;font-size:16px!important;font-family:Consolas,Georgia,serif}@media (max-width:800px){div#ds-thread #ds-reset .ds-textarea-wrapper textarea{height:70px!important}}div#ds-thread #ds-reset .ds-post-options{overflow:hidden}div#ds-thread #ds-reset .ds-post-toolbar{box-shadow:none}div#ds-thread #ds-reset .ds-post-button{position:relative;margin-top:20px;font-size:16px}div#ds-thread #ds-reset .ds-post-options{margin-right:0!important;border-right:1px solid #CCC}@media screen and (max-width:641px){div#ds-thread #ds-reset .ds-replybox{padding:0!important}div#ds-thread #ds-reset .ds-replybox .ds-avatar{display:none!important}.ds-post-self:hover .ds-post-reply,.ds-post-self:hover .ds-post-report,.ds-post-self:hover .ds-post-repost{display:none!important}}div#ds-thread #ds-reset .ds-comment-body p{white-space:pre-wrap;font-family:consolas!important}#ds-thread #ds-reset .ds-paginator a{font-size:20px!important}#ds-thread #ds-reset .ds-login-buttons p{color:#999}#ds-thread #ds-reset .ds-comment-body{background:#fbfbfb;padding:15px 15px 12px 32px;border-radius:5px;box-shadow:0 1px 2px rgba(0,0,0,.15),0 1px 0 rgba(255,255,255,.75) inset}</style><script type="text/javascript">var duoshuoQuery={short_name:"songjz"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></div><div class="web-info">Copyright © 2016-2017,本站由 <a href="/blog/web-info">本人</a> 手工打造,历时2周, <a href="/blog/web-info/#link">联系方式</a> <span>网站参考 <a href="http://www.barretlee.com/">小胡子哥</a>/ <a href="http://www.ruanyifeng.com/home.html">阮一峰老师</a></span></div></div><div class="tools"><i class="back-to-top" style="display:none"></i> <i class="goto-comments"></i></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/all.min.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?513bc3e28555252418b03cc8e660bc31";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85346637-1","auto"),ga("send","pageview")</script></body></html>